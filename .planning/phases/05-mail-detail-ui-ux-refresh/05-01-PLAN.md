---
phase: 05-mail-detail-ui-ux-refresh
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/src/utils/constants.js
  - frontend/src/pages/MailDetailPage.jsx
autonomous: true
requirements:
  - UIUX-01
  - UIUX-02
  - UIUX-03

must_haves:
  truths:
    - "Mail Detail page header shows the subject as the main h5 title"
    - "Serial number (sl_no) appears as a smaller subtitle below the subject"
    - "Status chip displays 'Pending' (grey) for Received and Assigned, 'In Progress' (amber) for In Progress, 'Closed' (green) for Closed"
    - "An overdue warning banner appears below the header when due_date is past and status is not Closed"
    - "@mui/lab is installed and available for Timeline components in plan 02"
  artifacts:
    - path: "frontend/src/utils/constants.js"
      provides: "DETAIL_STATUS_CHIP map used by MailDetailPage header"
      contains: "DETAIL_STATUS_CHIP"
    - path: "frontend/src/pages/MailDetailPage.jsx"
      provides: "Redesigned header block with subject title, sl_no subtitle, status chip, overdue banner"
      min_lines: 50
  key_links:
    - from: "frontend/src/pages/MailDetailPage.jsx"
      to: "frontend/src/utils/constants.js"
      via: "import DETAIL_STATUS_CHIP"
      pattern: "DETAIL_STATUS_CHIP"
---

<objective>
Install @mui/lab, add a DETAIL_STATUS_CHIP constant for the new status grouping logic, and replace the existing MailDetailPage header with the redesigned header block.

Purpose: The current header shows sl_no as the title and uses STATUS_COLORS which maps each raw status separately. The redesign requires: subject as the primary h5 title, sl_no as subtitle, a status chip with "Pending" for Received+Assigned, "In Progress" for In Progress, and "Closed" for Closed, plus an overdue warning banner below the header.

Output: @mui/lab installed, DETAIL_STATUS_CHIP constant added to constants.js, MailDetailPage header block replaced.
</objective>

<execution_context>
@C:/Users/vaish/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/vaish/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/pages/MailDetailPage.jsx
@frontend/src/utils/constants.js
@frontend/src/utils/dateHelpers.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @mui/lab</name>
  <files>frontend/package.json</files>
  <action>
Run `npm install @mui/lab` inside the frontend/ directory. This installs the MUI Lab package which provides Timeline, TimelineItem, TimelineSeparator, TimelineConnector, TimelineContent, TimelineDot, and TimelineOppositeContent components needed for plan 02. Verify it appears in package.json under dependencies after install.
  </action>
  <verify>Run `node -e "require('./node_modules/@mui/lab/package.json')"` from frontend/ to confirm the package is present.</verify>
  <done>@mui/lab is listed in frontend/package.json dependencies and node_modules/@mui/lab exists.</done>
</task>

<task type="auto">
  <name>Task 2: Add DETAIL_STATUS_CHIP constant</name>
  <files>frontend/src/utils/constants.js</files>
  <action>
Add a new exported constant `DETAIL_STATUS_CHIP` to constants.js that maps raw mail statuses to their display label and MUI chip color for use in the Mail Detail page header.

The mapping must follow the locked user decision (CONTEXT.md):
- 'Received' → { label: 'Pending', color: 'default' }
- 'Assigned' → { label: 'Pending', color: 'default' }
- 'In Progress' → { label: 'In Progress', color: 'warning' }
- 'Closed' → { label: 'Closed', color: 'success' }

Add after the existing STATUS_COLORS export. Do NOT change the existing STATUS_COLORS (it is used by the mail list page). The new constant is only for the detail page header.

```js
export const DETAIL_STATUS_CHIP = {
  [MAIL_STATUS.RECEIVED]: { label: 'Pending', color: 'default' },
  [MAIL_STATUS.ASSIGNED]: { label: 'Pending', color: 'default' },
  [MAIL_STATUS.IN_PROGRESS]: { label: 'In Progress', color: 'warning' },
  [MAIL_STATUS.CLOSED]: { label: 'Closed', color: 'success' },
};
```
  </action>
  <verify>Open constants.js and confirm DETAIL_STATUS_CHIP is exported with the four status keys and correct label/color pairs.</verify>
  <done>DETAIL_STATUS_CHIP is exported from constants.js with Received→Pending/default, Assigned→Pending/default, In Progress→In Progress/warning, Closed→Closed/success.</done>
</task>

<task type="auto">
  <name>Task 3: Replace MailDetailPage header with redesigned block</name>
  <files>frontend/src/pages/MailDetailPage.jsx</files>
  <action>
Replace the existing header Paper block (currently lines ~246-262 in the file) and the Completion Highlight block with the new redesigned header. The existing component structure (state, handlers, dialog imports) must NOT be changed — only the JSX return is being modified in this task.

**Changes to the import section:**
- Add `WarningAmber as WarningIcon` to the MUI icons imports (or use `Warning` icon from @mui/icons-material)
- Add `DETAIL_STATUS_CHIP` to the import from `'../utils/constants'`
- Keep all existing imports (Box, Paper, Typography, Chip, Button, Grid, Divider, etc.) — they will be used in plan 02

**Replace the header section:**

Remove the existing:
1. The `<Paper sx={{ p: 3, mb: 3 }}>` block that shows sl_no as h4 title with status chip
2. The Completion Highlight Paper block (the green "Final Action Taken" section)

Replace with a single `<Paper sx={{ p: 3, mb: 3 }}>` block that contains:

```jsx
<Paper sx={{ p: 3, mb: 3 }}>
  {/* Title row: Subject (h5) + Status chip */}
  <Box display="flex" justifyContent="space-between" alignItems="flex-start" gap={2}>
    <Box flex={1}>
      <Typography variant="h5" component="h1" fontWeight={700} sx={{ lineHeight: 1.3 }}>
        {mail.mail_reference_subject}
      </Typography>
      <Typography variant="body2" color="text.secondary" sx={{ mt: 0.5 }}>
        {mail.sl_no}
      </Typography>
    </Box>
    <Chip
      label={DETAIL_STATUS_CHIP[mail.status]?.label || mail.status}
      color={DETAIL_STATUS_CHIP[mail.status]?.color || 'default'}
      sx={{ flexShrink: 0, fontWeight: 600 }}
    />
  </Box>

  {/* Overdue banner: only shown when overdue and not Closed */}
  {overdue && (
    <Box
      display="flex"
      alignItems="center"
      gap={1}
      sx={{
        mt: 2,
        p: 1.5,
        borderRadius: 1,
        bgcolor: 'error.lighter',
        border: '1px solid',
        borderColor: 'error.light',
      }}
    >
      <WarningIcon color="error" fontSize="small" />
      <Typography variant="body2" color="error.dark" fontWeight={600}>
        Overdue by {Math.floor((new Date() - new Date(mail.due_date)) / (1000 * 60 * 60 * 24))} days
      </Typography>
    </Box>
  )}
</Paper>
```

The `overdue` variable already exists in the component (line ~226 of the original): `const overdue = isOverdue(mail.due_date, mail.status);` — do not redefine it.

Also remove the `isCompletedMail`, `finalActionTaken` variables and the green Completion Highlight Paper block entirely — per user decision, completion date belongs only in the audit trail, not on the detail page.

Keep the Back button above the header as-is.
Keep the pdfUploadWarning Alert as-is.
  </action>
  <verify>
1. Run `npm run build` from frontend/ — must complete with no errors.
2. Visually check: does the header show subject as h5 title with sl_no beneath it, and a status chip on the right?
3. For an overdue mail: does the warning banner appear?
  </verify>
  <done>MailDetailPage renders with subject as h5 title, sl_no as subtitle, correct status chip label (Pending/In Progress/Closed), and an overdue banner when applicable. Build has no errors.</done>
</task>

</tasks>

<verification>
1. `npm install` completes without errors in frontend/
2. `@mui/lab` appears in frontend/package.json under dependencies
3. `DETAIL_STATUS_CHIP` exported from constants.js with correct four-key mapping
4. MailDetailPage renders subject as h5 primary title, sl_no as secondary subtitle
5. Status chip shows "Pending" for both Received and Assigned mails
6. Overdue banner appears for past-due non-Closed mails
7. No build errors from the changes
</verification>

<success_criteria>
- @mui/lab installed and importable
- Header redesign matches UIUX-01 (h5 subject title), UIUX-02 (sl_no subtitle), UIUX-03 (Pending/In Progress/Closed chip grouping)
- Overdue banner shows "Overdue by X days" below header for overdue mails
- No regressions to existing functionality (all dialogs still work)
</success_criteria>

<output>
After completion, create `.planning/phases/05-mail-detail-ui-ux-refresh/05-01-SUMMARY.md`
</output>
